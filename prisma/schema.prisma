datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id               String         @id @default(cuid()) @map("_id")
  name             String?
  username         String?
  gh_username      String?
  email            String?        @unique
  emailVerified    DateTime?
  image            String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  accounts         Account[]
  sessions         Session[]
  password         String?
  role             UserRole       @default(Politician)
  politician       Politician?
  secretary        Secretary?
  client           Client?        @relation(fields: [clientId], references: [id])
  posts            Post[]
  website          Website?       @relation(fields: [websiteId], references: [id])
  websiteId        String?
  isActive         Boolean        @default(false)
  stripeCustomerId String?        @unique
  subscriptions    Subscription[]
  clientId         String?        @unique
  message          Message[]
}

enum UserRole {
  Admin
  Manager
  Politician
  Secretary
  Client
}

model Client {
  id        String     @id @default(cuid()) @map("_id")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  user      User?
  chatRoom  ChatRoom[]
}

model Secretary {
  id           String     @id @default(cuid()) @map("_id")
  politician   Politician @relation(fields: [politicianId], references: [id])
  politicianId String
  user         User       @relation(fields: [userId], references: [id])
  userId       String     @unique
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  chatRoom     ChatRoom[]
}

model Politician {
  id             String      @id @default(cuid()) @map("_id")
  party          String
  User           User        @relation(fields: [userId], references: [id])
  userId         String      @unique
  secretaries    Secretary[]
  description    String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  donation       Donation[]
  billingAddress Json?
  paymentMethod  Json?
  ChatRoom       ChatRoom[]
}

model Subscription {
  id                   String             @id @default(cuid()) @map("_id")
  user_id              String
  status               SubscriptionStatus
  metadata             Json
  price_id             String
  quantity             Int
  cancel_at_period_end Boolean
  created              DateTime
  current_period_start DateTime
  current_period_end   DateTime
  ended_at             DateTime?
  cancel_at            DateTime?
  canceled_at          DateTime?
  trial_start          DateTime?
  trial_end            DateTime?
  user                 User               @relation(fields: [user_id], references: [id])
  price                Price              @relation(fields: [price_id], references: [id])
  politicianId         String?
  Plan                 Plan?              @relation(fields: [planId], references: [id])
  planId               String?
}

enum SubscriptionStatus {
  TRIALING
  ACTIVE
  CANCELED
  INCOMPLETE
  INCOMPLETE_EXPIRED
  PAST_DUE
  UNPAID
  PAUSED
}

model Price {
  id                String              @id @default(cuid()) @map("_id")
  product_id        String
  active            Boolean
  description       String
  unit_amount       Int
  currency          String
  pricing_type      PricingType
  interval          PricingPlanInterval
  interval_count    Int
  trial_period_days Int?
  metadata          Json
  product           Product             @relation(fields: [product_id], references: [id])
  subscription      Subscription[]
}

enum PricingType {
  ONE_TIME
  RECURRING
}

enum PricingPlanInterval {
  DAY
  WEEK
  MONTH
  YEAR
}

model Product {
  id          String   @id @default(cuid()) @map("_id")
  active      Boolean
  name        String
  description String
  image       String
  metadata    Json
  Price       Price[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Account {
  id                       String  @id @default(cuid()) @map("_id")
  userId                   String
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String?
  refresh_token_expires_in Int?
  access_token             String?
  expires_at               Int?
  token_type               String?
  scope                    String?
  id_token                 String?
  session_state            String?
  oauth_token_secret       String?
  oauth_token              String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid()) @map("_id")
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  id         String   @id @default(cuid()) @map("_id")
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Post {
  id            String   @id @default(cuid()) @map("_id")
  title         String?
  description   String?
  content       String?
  slug          String   @default(cuid())
  image         String?  @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/hxfcV5V-eInX3jbVUhjAt1suB7zB88uGd1j20b.png")
  imageBlurhash String?  @default("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAhCAYAAACbffiEAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR4nN3XyZLDIAwE0Pz/v3q3r55JDlSBplsIEI49h76k4opexCK/juP4eXjOT149f2Tf9ySPgcjCc7kdpBTgDPKByKK2bTPFEdMO0RDrusJ0wLRBGCIuelmWJAjkgPGDSIQEMBDCfA2CEPM80+Qwl0JkNxBimiaYGOTUlXYI60YoehzHJDEm7kxjV3whOQTD3AaCuhGKHoYhyb+CBMwjIAFz647kTqyapdV4enGINuDJMSScPmijSwjCaHeLcT77C7EC0C1ugaCTi2HYfAZANgj6Z9A8xY5eiYghDMNQBJNCWhASot0jGsSCUiHWZcSGQjaWWCDaGMOWnsCcn2QhVkRuxqqNxMSdUSElCDbp1hbNOsa6Ugxh7xXauF4DyM1m5BLtCylBXgaxvPXVwEoOBjeIFVODtW74oj1yBQah3E8tyz3SkpolKS9Geo9YMD1QJR1Go4oJkgO1pgbNZq0AOUPChyjvh7vlXaQa+X1UXwKxgHokB2XPxbX+AnijwIU4ahazAAAAAElFTkSuQmCC")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  published     Boolean  @default(false)
  user          User     @relation(fields: [userId], references: [id])
  website       Website  @relation(fields: [websiteId], references: [id])
  userId        String
  websiteId     String

  @@unique([slug, websiteId])
  @@index([websiteId])
}

model Website {
  id            String        @id @default(cuid()) @map("_id")
  politicianId  String        @unique
  name          String?
  description   String?
  myHistory     String?
  logo          String        @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/JRajRyC-PhBHEinQkupt02jqfKacBVHLWJq7Iy.png")
  font          String        @default("font-cal")
  image         String        @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/hxfcV5V-eInX3jbVUhjAt1suB7zB88uGd1j20b.png")
  imageBlurhash String        @default("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAhCAYAAACbffiEAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR4nN3XyZLDIAwE0Pz/v3q3r55JDlSBplsIEI49h76k4opexCK/juP4eXjOT149f2Tf9ySPgcjCc7kdpBTgDPKByKK2bTPFEdMO0RDrusJ0wLRBGCIuelmWJAjkgPGDSIQEMBDCfA2CEPM80+Qwl0JkNxBimiaYGOTUlXYI60YoehzHJDEm7kxjV3whOQTD3AaCuhGKHoYhyb+CBMwjIAFz647kTqyapdV4enGINuDJMSScPmijSwjCaHeLcT77C7EC0C1ugaCTi2HYfAZANgj6Z9A8xY5eiYghDMNQBJNCWhASot0jGsSCUiHWZcSGQjaWWCDaGMOWnsCcn2QhVkRuxqqNxMSdUSElCDbp1hbNOsa6Ugxh7xXauF4DyM1m5BLtCylBXgaxvPXVwEoOBjeIFVODtW74oj1yBQah3E8tyz3SkpolKS9Geo9YMD1QJR1Go4oJkgO1pgbNZq0AOUPChyjvh7vlXaQa+X1UXwKxgHokB2XPxbX+AnijwIU4ahazAAAAAElFTkSuQmCC")
  subdomain     String?       @unique
  customDomain  String?       @unique
  message404    String        @default("Parabéns! Você encontrou uma página que não existe.")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  contact       Contact       @relation(fields: [contactId], references: [id])
  laws          Law[]
  events        Event[]
  projects      Project[]
  polls         Poll[]
  surveys       Survey[]
  proposals     Proposal[]
  news          News[]
  expenditures  Expenditure[]
  posts         Post[]
  donations     Donation[]
  user          User[]
  contactId     String
  ChatRoom      ChatRoom[]
  socialMedia   SocialMedia[]
}

model Contact {
  id        String    @id @default(cuid()) @map("_id")
  phone     String?
  email     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  website   Website[]
}

model SocialMedia {
  id        String            @id @default(cuid()) @map("_id")
  type      SocialMediaTypes? @unique
  handle    String?
  link      String?
  website   Website           @relation(fields: [websiteId], references: [id])
  websiteId String
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}

enum SocialMediaTypes {
  facebook
  twitter
  instagram
  youtube
  tiktok
}

model Proposal {
  id          String        @id @default(cuid()) @map("_id")
  type        ProposalTypes @unique
  description String
  website     Website       @relation(fields: [websiteId], references: [id])
  websiteId   String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

enum ProposalTypes {
  health
  security
  infrastructure
  education
}

model Donation {
  id           String          @id @default(cuid()) @map("_id")
  amount       Float
  date         DateTime        @default(now())
  userId       String
  websiteId    String
  politicianId String
  status       DonationStatus?
  updatedAt    DateTime        @updatedAt
  donator      String
  website      Website         @relation(fields: [websiteId], references: [id])
  politician   Politician?     @relation(fields: [politicianId], references: [id])
  createdAt    DateTime        @default(now())

  @@index([userId])
}

enum DonationStatus {
  pending
  completed
  failed
}

model Plan {
  id            String         @id @default(cuid()) @map("_id")
  name          String
  description   String
  amount        Float // Monthly subscription amount
  currency      String
  interval      String // Billing interval, e.g., "month", "year"
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  subscriptions Subscription[]
}

model Event {
  id          String    @id @default(cuid()) @map("_id")
  title       String?
  description String?
  eventStart  DateTime?
  eventEnd    DateTime?
  location    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  website     Website   @relation(fields: [websiteId], references: [id])
  websiteId   String
}

model Project {
  id          String   @id @default(cuid()) @map("_id")
  title       String?
  description String?
  published   Boolean  @default(false)
  slug        String   @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  website     Website  @relation(fields: [websiteId], references: [id])
  websiteId   String
}

model Law {
  id            String   @id @default(cuid()) @map("_id")
  title         String?
  content       String?
  image         String?  @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/hxfcV5V-eInX3jbVUhjAt1suB7zB88uGd1j20b.png")
  imageBlurhash String?  @default("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAhCAYAAACbffiEAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR4nN3XyZLDIAwE0Pz/v3q3r55JDlSBplsIEI49h76k4opexCK/juP4eXjOT149f2Tf9ySPgcjCc7kdpBTgDPKByKK2bTPFEdMO0RDrusJ0wLRBGCIuelmWJAjkgPGDSIQEMBDCfA2CEPM80+Qwl0JkNxBimiaYGOTUlXYI60YoehzHJDEm7kxjV3whOQTD3AaCuhGKHoYhyb+CBMwjIAFz647kTqyapdV4enGINuDJMSScPmijSwjCaHeLcT77C7EC0C1ugaCTi2HYfAZANgj6Z9A8xY5eiYghDMNQBJNCWhASot0jGsSCUiHWZcSGQjaWWCDaGMOWnsCcn2QhVkRuxqqNxMSdUSElCDbp1hbNOsa6Ugxh7xXauF4DyM1m5BLtCylBXgaxvPXVwEoOBjeIFVODtW74oj1yBQah3E8tyz3SkpolKS9Geo9YMD1QJR1Go4oJkgO1pgbNZq0AOUPChyjvh7vlXaQa+X1UXwKxgHokB2XPxbX+AnijwIU4ahazAAAAAElFTkSuQmCC")
  published     Boolean  @default(false)
  slug          String   @default(cuid())
  description   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  website       Website  @relation(fields: [websiteId], references: [id])
  websiteId     String
}

model News {
  id          String   @id @default(cuid()) @map("_id")
  title       String?
  content     String?
  publishedAt DateTime
  website     Website  @relation(fields: [websiteId], references: [id])
  websiteId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Expenditure {
  id          String    @id @default(cuid()) @map("_id")
  description String?
  amount      Float?
  date        DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  website     Website   @relation(fields: [websiteId], references: [id])
  websiteId   String
}

model Poll {
  id        String   @id @default(cuid()) @map("_id")
  question  String?
  options   Json[]
  votes     Json[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  websiteId String
  website   Website  @relation(fields: [websiteId], references: [id])
}

model Survey {
  id        String   @id @default(cuid()) @map("_id")
  question  String?
  options   Json[]
  responses Json[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  websiteId String
  website   Website  @relation(fields: [websiteId], references: [id])
}

model ChatRoom {
  id           String      @id @default(cuid())
  messages     Message[]
  website      Website     @relation(fields: [websiteId], references: [id])
  client       Client      @relation(fields: [clientId], references: [id])
  secretary    Secretary?  @relation(fields: [secretaryId], references: [id])
  politician   Politician? @relation(fields: [politicianId], references: [id])
  clientId     String
  secretaryId  String?
  politicianId String?
  websiteId    String
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Message {
  id         String   @id @default(cuid())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  text       String
  file       String?
  user       User     @relation(fields: [userId], references: [id])
  chatRoom   ChatRoom @relation(fields: [chatRoomId], references: [id])
  chatRoomId String
  userId     String
}
